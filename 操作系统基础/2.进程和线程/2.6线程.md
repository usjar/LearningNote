[toc]

### 线程的引入

·操作系统中引入线程，则是为了减少程序执行所付出的时间开销，使操作系统具有更好的并发性

#### 线程的定义

- 线程是进程内的一个执行单元
- 线程是进程内的一个可调度实体
- 线程是程序(或进程)中相对独立的一个控制流序列
- 线程是执行的上下文，其含义是执行的现场数据和其他调度的信息

·多线程是指一个程序中有多个线程，这些线程共享该进程资源，这些线程驻留在相同的地址空间中，共享数据和文件。如果一个线程修改了数据项，其他线程可以了解和使用此结果数据。一个线程打开并读一个文件时，同一个进程中的其他线程也可以同时读此文件。
引入了线程后，线程作为CPU调度单位，而进程只作为其他资源的分配单位。线程减小了开发执行的时间和空间开销，因此允许在系统中建立更多的线程来提高并发程度。

#### 线程的实现



·在操作系统中有多种方法可以实现对线程的实现。最自然的的方法是由操作系统 的内核提供线程的控制机制。在只有进程的操作系统中，可以由用户程序利用函数库提供线程的控制机制。还有一种做法是同时在操作系统内核和用户程序两个层次上提供线程控制机制。
线程可以分为==内核级线程，用户级线程==

- 内核级线程是指依赖于内核，有操作系统内核完成创建，撤销和切换的线程。在支持内核级线程的操作系统中，内核维护进程和线程的上下文信息并完成线程切换工作。当一个内核级线程由于IO操作而阻塞时，不会影响其他线程的运行。这时，处理机时间的分配对象是线程，所以有多个线程的进程将获得更多处理机时间。
- 用户级线程是指不依赖于操作系统内核，由应用进程利用线程库提供创建、同步、调度和管理线程的函数来控制的线程。由于用户级线程的调度在应用进程内部进行，通常采用非抢占方式和更简单的规则，也无须用户态/核心态切换，因此速度特别快。由于操作系统内核不了解用户级线程的存给在，当一个线程阻塞时，整个进程都必须等待，这时处理机的时间是分配进程的，当一个进程由多个线程时，每个线程的执行时间相对就少一些。

##### 多线程模型

- 多对一模型：将多个用户级别线程映射到一个内核级线程。线程管理在用户空间完成，所以它的效率比较高。如果一个线程因执行系统调用而阻塞，那么整个进程都将被阻塞。另外，因为一次只有一个线程可以访问内核，所以在多处理机环境中多个线程不能够并发执行。
- 一对一模型：将每个用户级别线程映射到一个内核级线程，当一个线程因为执行系统调用而阻塞时，允许调度其他线程执行，从而提供了比一对多模型更好的并发性;它也允许多个线程在多处理机环境中并行执行。这种模型的唯一缺点在于创建一个用户级线程就对应要创建一个内核级线程。
- 多对多模型：将多个用户级别线程映射到较少或者相等个数的内核级别线程上。内核级线程的苏亮有具体的程序或具体的机器确定；

#### 进程与线程的比较

·可以在以下几个方面对线程和进程进行比较

- 调度：在传统的操作系统中,拥有资源和独立调度的基本单位都是进程。在引入线程的操作系统中，线程是独立调度的基本单位，进程是资源拥有的基本单位。在同一个进程中线程的切换不会引起进程的切换。在不同进程中进行线程切换，如从一个进程内的线程切换到另一个进程捏的线程时，会引起进程的切换。
- 拥有资源：不论是传统操作系统的还是没有引入线程的操作系统，进程都是拥有资源的基本单位，而线程不拥有系统资源，但线程可以访问其隶属进程的系统资源。
- 并发性：在引入线程的操作系统中，不仅进程之间可以并发执行，而且同一进程里的多个线程亦可以并发执行，从而使操作系统具有更好的并发性，大大提高了系统的吞吐量
- 系统开销：由于创建进程或撤销进程时，系统都要为之分配或者回收资源，如内存空间IO设备等，操作系统说付出的开销远大于创建进程和撤销进程时的开销。